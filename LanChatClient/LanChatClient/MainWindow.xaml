<Window x:Class="LanChatClient.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:tb="clr-namespace:Hardcodet.Wpf.TaskbarNotification;assembly=Hardcodet.NotifyIcon.Wpf"
        xmlns:local="clr-namespace:LanChatClient"
        Title="LAN Chat" Height="672" Width="360"
        WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/Assets/chat.ico"
        FontFamily="Segoe UI"
        Background="{DynamicResource BrushBackground}">

    <Window.Resources>
        <local:InitialsConverter x:Key="InitialsConverter"/>
        <local:AvatarBrushConverter x:Key="AvatarBrushConverter"/>
    </Window.Resources>

    <Grid Margin="12">

        <!-- Tray -->
        <tb:TaskbarIcon x:Name="TrayIcon"
                        ToolTipText="LAN Chat"
                        IconSource="pack://application:,,,/Assets/chat.ico"
                        Visibility="Visible">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Pokaż listę" Click="Tray_Show_Click"/>
                    <Separator/>
                    <MenuItem Header="Wyjdź" Click="Tray_Exit_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0"
                    Background="{DynamicResource BrushPrimaryDark}"
                    CornerRadius="12"
                    Padding="10"
                    Margin="0,0,0,10">
                <TextBlock Text="Kontakty"
                           Foreground="White"
                           FontWeight="SemiBold"
                           FontSize="15"/>
            </Border>

            <!-- Lista kontaktów (kompaktowa, scroll) -->
            <ListBox Grid.Row="1"
                     x:Name="UsersList"
                     MouseDoubleClick="UsersList_DoubleClick"
                     Background="Transparent"
                     BorderThickness="0"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.VirtualizationMode="Recycling">

                <ListBox.ItemContainerStyle>
                    <Style TargetType="{x:Type ListBoxItem}">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0,0,0,6"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                    </Style>
                </ListBox.ItemContainerStyle>

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="8"
                                Background="{DynamicResource BrushPanel}"
                                CornerRadius="12"
                                BorderBrush="{DynamicResource BrushBorder}"
                                BorderThickness="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar z inicjałami -->
                                <Grid Width="28" Height="28" VerticalAlignment="Center">
                                    <Ellipse Fill="{Binding Display, Converter={StaticResource AvatarBrushConverter}}"
                                             Opacity="0.92"/>
                                    <TextBlock Text="{Binding Display, Converter={StaticResource InitialsConverter}}"
                                               Foreground="White"
                                               FontWeight="SemiBold"
                                               FontSize="11"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                </Grid>

                                <!-- Nazwa + status -->
                                <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Display}"
                                               FontWeight="SemiBold"
                                               FontSize="12"
                                               Foreground="{DynamicResource BrushText}"/>
                                    <TextBlock Text="{Binding Status}"
                                               FontSize="10"
                                               Foreground="{DynamicResource BrushSubtleText}"/>
                                </StackPanel>

                                <!-- Online dot -->
                                <Ellipse Grid.Column="2"
                                         Width="9" Height="9"
                                         VerticalAlignment="Center"
                                         Margin="10,0,0,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="#FFB0B8BF"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsOnline}" Value="True">
                                                    <Setter Property="Fill" Value="#FF25D366"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>

            <Button Grid.Row="2"
                    Content="Zmień nazwę użytkownika"
                    Margin="0,6,0,0"
                    Height="40"
                    Click="ChangeName_Click"/>

            <TextBlock Grid.Row="3"
                       x:Name="StatusText"
                       Margin="0,10,0,0"
                       TextWrapping="Wrap"
                       Foreground="{DynamicResource BrushSubtleText}"/>
        </Grid>
    </Grid>
</Window>